<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TopUp Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f8fafc; }
        .nav-gradient { background: white; color: #1e293b; }
        .active-tab { color: #ec4899 !important; }
        .hidden { display: none !important; }
        
        /* Notice Scrolling Animation */
        .notice-scroll { animation: scroll-left 15s linear infinite; display: inline-block; white-space: nowrap; }
        @keyframes scroll-left { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        
        /* Method Card */
        .method-card { transition: all 0.2s; border: 2px solid transparent; }
        .method-card:active { transform: scale(0.95); }
        
        /* Support Float */
        .support-float { animation: float 3s ease-in-out infinite; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }

        /* Animations */
        @keyframes fadeInUp { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-fade-in { animation: fadeInUp 0.4s ease-out forwards; }

        /* --- PRODUCT CARD STYLE --- */
        .product-card {
            border: 1px solid #e2e8f0;
            background: white;
            padding: 12px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .product-card:hover { border-color: #f9a8d4; }
        .product-card.selected {
            border: 1.5px solid #ec4899; /* Pink Border */
            background-color: #fff; 
        }
        .product-bullet {
            height: 8px; width: 8px; background-color: #cbd5e1; border-radius: 50%; margin-right: 8px;
        }
        .product-card.selected .product-bullet { background-color: #ec4899; }
    </style>
</head>
<body class="select-none bg-slate-50">

<!-- AUTH SECTION -->
<section id="auth-sec" class="min-h-screen flex flex-col items-center justify-center p-6 bg-white z-50 fixed inset-0">
    <div class="w-full max-w-sm">
        <div class="text-center mb-8">
            <!-- UPDATED LOGO HERE -->
            <img id="auth-logo-img" src="https://i.postimg.cc/YCXZFzdR/file-00000000a04072069e266d3f98e37001-(1).png" class="h-20 mx-auto mb-3 object-contain">
            <p class="text-gray-500 text-sm">Best TopUp Service in BD</p>
        </div>

        <div class="flex bg-gray-100 p-1 rounded-lg mb-6">
            <button onclick="toggleAuth('login')" id="btn-login-view" class="w-1/2 py-2 rounded-md font-bold text-sm bg-white shadow text-pink-600 transition">Login</button>
            <button onclick="toggleAuth('register')" id="btn-reg-view" class="w-1/2 py-2 rounded-md font-bold text-sm text-gray-500 transition">Register</button>
        </div>

        <div id="login-form">
            <input type="email" id="login-email" placeholder="Email Address" class="w-full bg-gray-50 border border-gray-300 p-3 rounded-lg focus:outline-none focus:border-pink-500 mb-3">
            <input type="password" id="login-pass" placeholder="Password" class="w-full bg-gray-50 border border-gray-300 p-3 rounded-lg focus:outline-none focus:border-pink-500 mb-4">
            <button onclick="handleLogin()" class="w-full bg-pink-600 text-white py-3 rounded-lg font-bold shadow-lg hover:bg-pink-700 transition">LOG IN</button>
        </div>

        <div id="register-form" class="hidden">
            <input type="text" id="reg-name" placeholder="Full Name" class="w-full bg-gray-50 border border-gray-300 p-3 rounded-lg focus:outline-none focus:border-pink-500 mb-3">
            <input type="email" id="reg-email" placeholder="Email Address" class="w-full bg-gray-50 border border-gray-300 p-3 rounded-lg focus:outline-none focus:border-pink-500 mb-3">
            <input type="number" id="reg-phone" placeholder="Phone Number" class="w-full bg-gray-50 border border-gray-300 p-3 rounded-lg focus:outline-none focus:border-pink-500 mb-3">
            <input type="password" id="reg-pass" placeholder="Password (6+ chars)" class="w-full bg-gray-50 border border-gray-300 p-3 rounded-lg focus:outline-none focus:border-pink-500 mb-4">
            <button onclick="handleRegister()" class="w-full bg-gray-800 text-white py-3 rounded-lg font-bold shadow-lg hover:bg-gray-900 transition">CREATE ACCOUNT</button>
        </div>
    </div>
</section>

<!-- APP CONTENT -->
<div id="app-content" class="hidden relative max-w-md mx-auto bg-slate-50 min-h-screen shadow-2xl">
    <!-- Header -->
    <header class="bg-white p-4 sticky top-0 z-40 flex justify-between items-center shadow-sm">
        <div class="flex items-center gap-2">
            <!-- UPDATED HEADER LOGO HERE -->
            <img id="header-logo-img" src="https://i.postimg.cc/YCXZFzdR/file-00000000a04072069e266d3f98e37001-(1).png" class="h-10 object-contain">
        </div>
        <div class="bg-gray-100 px-3 py-1 rounded-full text-xs font-bold text-gray-600 border border-gray-200">
            <i class="fas fa-wallet mr-1 text-pink-500"></i> ৳ <span id="header-balance">0</span>
        </div>
    </header>

    <!-- Notice Section -->
    <div class="bg-pink-600 text-white py-2 overflow-hidden shadow-inner flex items-center">
        <div class="px-3 bg-pink-800 h-full flex items-center z-10 font-bold text-xs uppercase tracking-wider">Notice</div>
        <div class="flex-1 overflow-hidden relative">
            <div id="notice-text" class="notice-scroll text-sm font-medium pl-4">Loading notice...</div>
        </div>
    </div>

    <!-- Main Container -->
    <main class="p-3 relative">
        
        <!-- HOME SECTION -->
        <section id="home-sec" class="animate-fade-in">
            <!-- Dynamic Slider -->
            <div id="banner-container" class="mb-6 rounded-xl overflow-hidden shadow-md h-44 bg-gray-200 relative group">
                <div id="slider-wrapper" class="flex h-full w-full transition-transform duration-500 ease-out">
                    <img src="https://placehold.co/600x300/e2136e/FFF?text=Loading..." class="w-full h-full object-cover flex-shrink-0">
                </div>
                <div id="slider-dots" class="absolute bottom-3 left-0 right-0 flex justify-center gap-2 z-10"></div>
            </div>

            <!-- CONTACT & APP GRID -->
            <div class="grid grid-cols-3 gap-3 mb-5 px-2">
                <!-- WhatsApp Button -->
                <a id="home-whatsapp" href="#" class="bg-white py-2 rounded-xl shadow-[0_2px_8px_rgba(0,0,0,0.05)] border border-gray-100 flex flex-col items-center justify-center gap-1.5 active:scale-95 transition h-24 no-underline">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center bg-green-50">
                        <i class="fab fa-whatsapp text-3xl text-[#25D366]"></i>
                    </div>
                    <span class="text-[11px] font-bold text-gray-700">WhatsApp</span>
                </a>

                <!-- Telegram Button -->
                <a id="home-telegram" href="#" class="bg-white py-2 rounded-xl shadow-[0_2px_8px_rgba(0,0,0,0.05)] border border-gray-100 flex flex-col items-center justify-center gap-1.5 active:scale-95 transition h-24 no-underline">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center bg-blue-50">
                        <i class="fab fa-telegram-plane text-3xl text-[#0088cc]"></i>
                    </div>
                    <span class="text-[11px] font-bold text-gray-700">Telegram</span>
                </a>

                <!-- App Download Button -->
                <a id="home-app-dl" href="#" target="_blank" class="bg-white py-2 rounded-xl shadow-[0_2px_8px_rgba(0,0,0,0.05)] border border-gray-100 flex flex-col items-center justify-center gap-1.5 active:scale-95 transition h-24 no-underline">
                    <div class="w-10 h-10 rounded-full overflow-hidden shadow-sm">
                        <img src="https://i.ibb.co.com/WvrTGr5Y/google-play-store-logo-1273375-804.jpg" 
                             class="w-full h-full object-cover" alt="App DL">
                    </div>
                    <span class="text-[11px] font-bold text-gray-700 text-center leading-tight">App<br>Download</span>
                </a>
            </div>

            <div class="flex items-center justify-between mb-3 px-1">
                <h3 class="font-bold text-gray-700 text-lg border-l-4 border-pink-500 pl-2">All Products</h3>
            </div>
            
            <div id="services-list" class="grid grid-cols-3 gap-3 px-1 mb-8">
                <div class="col-span-3 text-center py-10"><i class="fas fa-spinner fa-spin text-pink-500"></i> Loading Games...</div>
            </div>

            <!-- LATEST 5 ORDERS -->
            <div class="mt-8 mb-6">
                <h3 class="text-center font-bold text-slate-700 text-xl mb-5 font-serif">Latest 5 Orders</h3>
                <div id="latest-orders-list" class="space-y-3 px-1">
                    <!-- Skeleton Loader -->
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between animate-pulse">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-gray-200 rounded-full"></div>
                            <div>
                                <div class="h-4 bg-gray-200 rounded w-24 mb-2"></div>
                                <div class="h-3 bg-gray-200 rounded w-32"></div>
                            </div>
                        </div>
                        <div class="h-6 bg-gray-200 rounded-full w-20"></div>
                    </div>
                </div>
            </div>

            <!-- FOOTER SECTION -->
            <div class="mt-10 -mx-3 bg-[#880E4F] text-white pt-8 px-5 rounded-t-3xl shadow-[0_-10px_40px_rgba(0,0,0,0.2)] pb-20">  
                <div class="mb-6">
                    <h3 class="font-serif text-xl font-medium tracking-wide mb-3">STAY CONNECTED</h3>
                    <p class="text-xs text-pink-100 font-light leading-relaxed mb-4 opacity-90">
                        কোন সমস্যায় পড়লে হোয়াটসঅ্যাপ এ যোগাযোগ করবেন। তাহলে দ্রুত সমাধান পেয়ে যাবেন।
                    </p>
                    <div class="flex gap-4">
                        <a id="ft-fb" href="#" class="w-10 h-10 border border-pink-300/30 rounded-lg flex items-center justify-center hover:bg-white hover:text-[#880E4F] transition"><i class="fab fa-facebook-f"></i></a>
                        <a id="ft-insta" href="#" class="w-10 h-10 border border-pink-300/30 rounded-lg flex items-center justify-center hover:bg-white hover:text-[#880E4F] transition"><i class="fab fa-instagram"></i></a>
                        <a id="ft-yt" href="#" class="w-10 h-10 border border-pink-300/30 rounded-lg flex items-center justify-center hover:bg-white hover:text-[#880E4F] transition"><i class="fab fa-youtube"></i></a>
                        <a href="#" class="w-10 h-10 border border-pink-300/30 rounded-lg flex items-center justify-center hover:bg-white hover:text-[#880E4F] transition"><i class="far fa-envelope"></i></a>
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="font-serif text-xl font-medium tracking-wide mb-3">OUR MOBILE APP</h3>
                    <a id="ft-app-link" href="#" target="_blank" class="inline-block border border-white/40 rounded-lg overflow-hidden w-36 hover:opacity-80 transition">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/7/78/Google_Play_Store_badge_EN.svg" alt="Get it on Google Play" class="w-full h-auto">
                    </a>
                </div>

                <div class="mb-8">
                    <h3 class="font-serif text-xl font-medium tracking-wide mb-3">SUPPORT CENTER</h3>
                    <a id="ft-whatsapp" href="#" class="block mb-3 group">
                        <div class="border border-pink-300/30 rounded-lg p-2.5 flex items-center gap-3 group-hover:bg-white/10 transition">
                            <div class="w-10 h-10 flex items-center justify-center"><i class="fab fa-whatsapp text-3xl"></i></div>
                            <div class="border-l border-pink-300/30 pl-3 h-full flex flex-col justify-center">
                                <span class="text-[9px] text-pink-200 uppercase tracking-wider">Help line [9AM - 10PM]</span>
                                <span id="ft-wa-num" class="font-bold text-lg font-mono leading-none mt-0.5">+8801xxxxxxxxx</span>
                            </div>
                        </div>
                    </a>
                    <a id="ft-telegram" href="#" class="block group">
                        <div class="border border-pink-300/30 rounded-lg p-2.5 flex items-center gap-3 group-hover:bg-white/10 transition">
                            <div class="w-10 h-10 flex items-center justify-center"><i class="fab fa-telegram-plane text-3xl"></i></div>
                            <div class="border-l border-pink-300/30 pl-3 h-full flex flex-col justify-center">
                                <span class="text-[9px] text-pink-200 uppercase tracking-wider">Help line [9AM - 10PM]</span>
                                <span class="font-bold text-lg leading-none mt-0.5">Telegram Support</span>
                            </div>
                        </div>
                    </a>
                </div>

                <div class="text-center border-t border-pink-900/50 pt-4">
                    <p class="text-[10px] text-pink-200 opacity-70 mb-1">
                        © Copyright 2026 <span id="footer-site-name" class="font-bold">TopUp Store</span>. All Rights Reserved.
                    </p>
                    <p class="text-xs font-medium text-pink-100 mb-0">
                        Developed by <a href="#" class="text-yellow-400 font-bold hover:underline">KHELO BUZZ</a>
                    </p>
                </div>
            </div>
        </section>

        <!-- TOPUP INTERFACE SECTION -->
        <section id="topup-sec" class="hidden animate-fade-in pb-10">
            <!-- Top Header with Back Button -->
            <div class="flex items-center gap-3 mb-4 p-1">
                <button onclick="showSec('home')" class="text-gray-600 hover:text-pink-500 w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200">
                    <i class="fas fa-arrow-left text-lg"></i>
                </button>
                <h2 class="text-lg font-bold text-gray-800" id="topup-game-title">Game Name</h2>
            </div>

            <!-- Game Info Card -->
            <div class="bg-white p-3 rounded-xl shadow-sm flex items-center gap-4 mb-4 border border-gray-100">
                <img id="topup-game-img" src="" class="w-16 h-16 rounded-xl object-cover shadow-sm">
                <div>
                    <h3 class="font-bold text-gray-800 text-base" id="topup-sub-title">FF UID TOPUP (BD)</h3>
                    <p class="text-xs text-gray-400 font-medium">Game / Topup</p>
                </div>
            </div>

            <!-- 1. Player ID Input & BUY BUTTON -->
            <div class="bg-white p-4 rounded-xl shadow-sm mb-4 border border-gray-100">
                <div class="flex items-center gap-2 mb-3">
                    <span class="bg-pink-600 text-white w-6 h-6 flex items-center justify-center rounded-full text-xs font-bold shadow-md">1</span>
                    <h3 class="font-bold text-gray-700 text-sm">Player Id</h3>
                </div>
                <input type="text" id="game-player-id" placeholder="2535040417" class="w-full bg-gray-50 border border-gray-200 p-3 rounded-lg focus:outline-none focus:border-pink-500 focus:bg-white transition font-bold text-gray-700 tracking-wider text-lg">
                
                <div class="mt-3 bg-gradient-to-r from-blue-400 to-teal-400 text-white text-center py-2 rounded-lg font-bold text-sm shadow-md">
                    YOUR FREE FIRE UID
                </div>

                <!-- MOVED BUY SECTION HERE -->
                <div class="mt-5 border-t border-gray-100 pt-4">
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-sm font-bold text-gray-600">Total Payable</span>
                        <span class="text-xl font-bold text-pink-600">৳ <span id="total-price">0</span></span>
                    </div>
                    <button onclick="processOrder()" class="w-full bg-pink-600 text-white py-3 rounded-lg font-bold shadow-lg hover:bg-pink-700 transition flex justify-center items-center gap-2 active:scale-95">
                         BUY NOW
                    </button>
                </div>
            </div>

            <!-- 2. Select Recharge (Grid List) -->
            <div class="bg-white p-4 rounded-xl shadow-sm mb-4 border border-gray-100">
                <div class="flex items-center gap-2 mb-4">
                    <span class="bg-pink-600 text-white w-6 h-6 flex items-center justify-center rounded-full text-xs font-bold shadow-md">2</span>
                    <h3 class="font-bold text-gray-700 text-sm">Select Recharge</h3>
                </div>

                <!-- Product Loader -->
                <div id="product-loader" class="text-center py-10 hidden">
                    <i class="fas fa-spinner fa-spin text-pink-500 text-2xl"></i>
                </div>

                <!-- Dynamic Products Grid -->
                <div id="products-grid" class="grid grid-cols-2 gap-3">
                    <!-- Products will be injected via JS -->
                </div>
            </div>

            <!-- RULES BOX -->
            <div id="game-rules-box" class="bg-yellow-50 border border-yellow-200 p-4 rounded-xl shadow-sm mb-6 hidden">
                <div class="flex items-center gap-2 mb-2">
                    <i class="fas fa-exclamation-triangle text-yellow-600"></i>
                    <h3 class="font-bold text-yellow-700 text-sm">Important Rules</h3>
                </div>
                <p id="game-rules-text" class="text-xs text-yellow-800 leading-relaxed font-medium">
                    <!-- Rules text will appear here -->
                </p>
            </div>
        </section>

        <!-- ADD MONEY SECTION -->
        <section id="addmoney-sec" class="hidden animate-fade-in">
            <h2 class="font-bold text-xl text-gray-800 mb-4 px-2">Add Money</h2>
            
            <!-- Payment Methods Grid -->
            <div id="payment-methods-grid" class="grid grid-cols-3 gap-3 mb-6">
                <!-- bKash -->
                <div onclick="showPaymentForm('bKash', 'https://i.ibb.co.com/9kCCTNsx/1656227518bkash-logo-png.png', '#e2136e')" 
                     class="bg-white p-3 rounded-xl shadow-sm flex flex-col items-center justify-center cursor-pointer method-card h-28">
                    <img src="https://i.ibb.co.com/9kCCTNsx/1656227518bkash-logo-png.png" class="w-12 h-12 object-contain mb-2">
                    <span class="text-xs font-bold text-gray-600">bKash</span>
                </div>
                <!-- Nagad -->
                <div onclick="showPaymentForm('Nagad', 'https://i.ibb.co.com/VcqJTvpn/Nagad-Logo-horizontally-og.png', '#f7941d')" 
                     class="bg-white p-3 rounded-xl shadow-sm flex flex-col items-center justify-center cursor-pointer method-card h-28">
                    <img src="https://i.ibb.co.com/VcqJTvpn/Nagad-Logo-horizontally-og.png" class="w-16 h-12 object-contain mb-2">
                    <span class="text-xs font-bold text-gray-600">Nagad</span>
                </div>
                <!-- Rocket -->
                <div onclick="showPaymentForm('Rocket', 'https://i.ibb.co.com/wFZkNM48/rocket-color-logo-mobile-banking-icon-free-png.png', '#8c3494')" 
                     class="bg-white p-3 rounded-xl shadow-sm flex flex-col items-center justify-center cursor-pointer method-card h-28">
                    <img src="https://i.ibb.co.com/wFZkNM48/rocket-color-logo-mobile-banking-icon-free-png.png" class="w-10 h-12 object-contain mb-2">
                    <span class="text-xs font-bold text-gray-600">Rocket</span>
                </div>
            </div>

            <!-- Payment Input Form -->
            <div id="payment-form-container" class="hidden bg-white p-5 rounded-2xl shadow-lg border border-gray-100">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center gap-2">
                        <img id="form-logo" src="" class="w-8 h-8 object-contain">
                        <h3 id="form-method-name" class="font-bold text-lg text-gray-800">Method</h3>
                    </div>
                    <button onclick="resetAddMoney()" class="text-gray-400 hover:text-red-500"><i class="fas fa-times"></i></button>
                </div>
                
                <div class="bg-gray-50 p-3 rounded-lg border border-gray-200 mb-4 flex justify-between items-center">
                    <div>
                        <p class="text-[10px] text-gray-500">Send Money (Personal)</p>
                        <p id="admin-number" class="font-mono font-bold text-lg tracking-wider text-gray-700">Loading...</p>
                    </div>
                    <button onclick="copyNumber()" class="bg-white p-2 rounded shadow-sm text-pink-600"><i class="far fa-copy"></i></button>
                </div>

                <div class="space-y-4">
                    <input type="number" id="dep-amount" placeholder="Amount" class="w-full bg-gray-50 border border-gray-200 p-3 rounded-lg font-bold focus:outline-none focus:border-pink-500">
                    <input type="text" id="dep-trx" placeholder="Transaction ID" class="w-full bg-gray-50 border border-gray-200 p-3 rounded-lg font-bold uppercase focus:outline-none focus:border-pink-500">
                    <button onclick="submitDeposit()" class="w-full bg-pink-600 text-white py-3 rounded-lg font-bold shadow-lg hover:bg-pink-700 transition">Verify & Add Money</button>
                </div>
            </div>
        </section>

        <!-- TUTORIAL SECTION -->
        <section id="tutorial-sec" class="hidden animate-fade-in pb-20">
            <div class="px-5 pt-6 mb-4">
                <h2 class="text-2xl font-bold text-gray-800">Tutorials</h2>
            </div>
            <div id="tutorial-list-container" class="space-y-6"></div>
        </section>

        <!-- ACCOUNT SECTION (UPDATED) -->
        <section id="account-sec" class="hidden animate-fade-in">
            <div class="bg-white p-6 rounded-xl shadow-sm mb-4 text-center border border-gray-100">
                <!-- Profile Image -->
                <div class="w-20 h-20 bg-pink-50 rounded-full mx-auto flex items-center justify-center text-pink-500 text-3xl mb-3 shadow-inner">
                    <i class="fas fa-user-circle text-5xl"></i>
                </div>
                
                <!-- Name & Email -->
                <h2 id="profile-name" class="font-bold text-xl text-gray-800">User Name</h2>
                <p id="profile-email" class="text-xs text-gray-500 mb-6 font-mono">user@email.com</p>

                <!-- NEW STATS GRID (Balance, Orders, Spent) -->
                <div class="grid grid-cols-3 gap-3">
                    <!-- Balance Box -->
                    <div class="bg-pink-50 p-3 rounded-2xl border border-pink-100 flex flex-col items-center justify-center">
                        <div class="w-8 h-8 rounded-full bg-pink-100 flex items-center justify-center text-pink-600 mb-1">
                            <i class="fas fa-wallet text-sm"></i>
                        </div>
                        <p class="text-[10px] text-gray-500 font-bold uppercase tracking-wider">Balance</p>
                        <p class="text-sm font-extrabold text-pink-600">৳ <span id="profile-balance">0</span></p>
                    </div>

                    <!-- Total Orders Box -->
                    <div class="bg-blue-50 p-3 rounded-2xl border border-blue-100 flex flex-col items-center justify-center">
                        <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 mb-1">
                            <i class="fas fa-shopping-bag text-sm"></i>
                        </div>
                        <p class="text-[10px] text-gray-500 font-bold uppercase tracking-wider">Orders</p>
                        <p class="text-sm font-extrabold text-blue-600" id="profile-total-orders">0</p>
                    </div>

                    <!-- Total Spent Box -->
                    <div class="bg-purple-50 p-3 rounded-2xl border border-purple-100 flex flex-col items-center justify-center">
                        <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 mb-1">
                            <i class="fas fa-coins text-sm"></i>
                        </div>
                        <p class="text-[10px] text-gray-500 font-bold uppercase tracking-wider">Spent</p>
                        <p class="text-sm font-extrabold text-purple-600">৳ <span id="profile-total-spent">0</span></p>
                    </div>
                </div>
            </div>

            <!-- Menu Buttons -->
            <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-gray-100">
                <button onclick="showSec('history')" class="w-full flex items-center justify-between p-4 border-b border-gray-100 hover:bg-gray-50 transition">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center text-blue-500"><i class="fas fa-history"></i></div>
                        <span class="text-sm font-semibold text-gray-700">Order History</span>
                    </div>
                    <i class="fas fa-chevron-right text-gray-300 text-xs"></i>
                </button>
                
                <button onclick="showSec('addmoney')" class="w-full flex items-center justify-between p-4 border-b border-gray-100 hover:bg-gray-50 transition">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg bg-green-50 flex items-center justify-center text-green-500"><i class="fas fa-plus-circle"></i></div>
                        <span class="text-sm font-semibold text-gray-700">Add Money</span>
                    </div>
                    <i class="fas fa-chevron-right text-gray-300 text-xs"></i>
                </button>

                <button onclick="handleLogout()" class="w-full flex items-center justify-between p-4 hover:bg-red-50 text-red-500 transition group">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg bg-red-50 flex items-center justify-center group-hover:bg-red-200 transition"><i class="fas fa-sign-out-alt"></i></div>
                        <span class="text-sm font-bold">Log Out</span>
                    </div>
                </button>
            </div>
        </section>

        <!-- HISTORY SECTION -->
        <section id="history-sec" class="hidden animate-fade-in pb-24">
            <div class="px-4 pt-4 mb-2">
                <h2 class="text-xl font-bold text-gray-800 border-l-4 border-pink-500 pl-2">Order History</h2>
            </div>
            <div id="history-list" class="px-4">
                <!-- History Cards will be injected here -->
            </div>
        </section>

    </main>

    <!-- FLOATING HELP BUTTON -->
    <div class="fixed bottom-20 right-4 z-40 support-float">
        <img onclick="toggleSupportModal()" src="https://i.ibb.co.com/RG5qbS8t/20260120-195807.png" class="w-[150px] h-auto cursor-pointer filter drop-shadow-xl hover:scale-105 transition-transform duration-200">
    </div>

    <!-- HELP POPUP MODAL -->
    <div id="support-modal" class="hidden fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm">
        <div class="bg-white p-6 rounded-2xl shadow-2xl w-72 relative animate-popup">
            <button onclick="toggleSupportModal()" class="absolute top-2 right-3 text-gray-400 hover:text-red-500 text-xl"><i class="fas fa-times"></i></button>
            <h3 class="font-bold text-center text-gray-800 text-lg mb-4">Contact Us</h3>
            <div class="flex flex-col gap-3">
                <a id="link-telegram" href="#" target="_blank" class="flex items-center justify-center gap-3 bg-[#0088cc] text-white py-3 rounded-xl shadow-md">
                    <i class="fab fa-telegram-plane text-2xl"></i> <span class="font-bold">Telegram</span>
                </a>
                <a id="link-whatsapp" href="#" target="_blank" class="flex items-center justify-center gap-3 bg-[#25D366] text-white py-3 rounded-xl shadow-md">
                    <i class="fab fa-whatsapp text-2xl"></i> <span class="font-bold">WhatsApp</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 w-full bg-white border-t border-gray-100 py-2 px-6 shadow-[0_-5px_20px_rgba(0,0,0,0.05)] z-40 max-w-md mx-auto left-0 right-0">
        <div class="flex justify-between items-center">
            <button onclick="showSec('home')" class="nav-item flex flex-col items-center text-gray-400 active-tab" id="nav-home">
                <i class="fas fa-home text-xl"></i><span class="text-[10px] mt-1 font-medium">Home</span>
            </button>
            <button onclick="showSec('tutorial')" class="nav-item flex flex-col items-center text-gray-400" id="nav-tutorial">
                <i class="fab fa-youtube text-xl"></i><span class="text-[10px] mt-1 font-medium">Tutorial</span>
            </button>
            
            <button onclick="showSec('addmoney')" class="add-money-btn bg-pink-600 -mt-8 h-14 w-14 rounded-full flex items-center justify-center text-white border-4 border-gray-50 transform active:scale-90 transition shadow-lg">
                <i class="fas fa-plus text-2xl"></i>
            </button>
            
            <button onclick="showSec('history')" class="nav-item flex flex-col items-center text-gray-400" id="nav-history">
                <i class="fas fa-history text-xl"></i><span class="text-[10px] mt-1 font-medium">History</span>
            </button>
            <button onclick="showSec('account')" class="nav-item flex flex-col items-center text-gray-400" id="nav-account">
                <i class="fas fa-user text-xl"></i><span class="text-[10px] mt-1 font-medium">Account</span>
            </button>
        </div>
    </nav>
</div>

<script>
    // --- 1. FIREBASE CONFIGURATION ---
    const firebaseConfig = {
      apiKey: "AIzaSyD8Rnh08XGw9HdYi0BYGCVBKd0ENBQl0CU",
      authDomain: "fh-top-up-2.firebaseapp.com",
      projectId: "fh-top-up-2",
      storageBucket: "fh-top-up-2.firebasestorage.app",
      messagingSenderId: "214767016319",
      appId: "1:214767016319:web:5f017307d5be94386d624a",
      measurementId: "G-VYS9QHSSK6"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    let currentUser = null;
    let userBalance = 0;
    let selectedProduct = null;
    let selectedGameId = null;
    let selectedGameName = "";
    let gamesData = {};

    // --- NEW: LOAD GLOBAL SETTINGS (LOGO & NAME) ---
    // FIXED: Path changed to 'settings/global' to match Admin Panel
    function loadGlobalSettings() {
        db.collection("settings").doc("global").onSnapshot((doc) => {
            if (doc.exists) {
                const data = doc.data();
                
                // Set Logo and Site Name
                const logoUrl = data.logoUrl || "https://i.postimg.cc/YCXZFzdR/file-00000000a04072069e266d3f98e37001-(1).png"; // UPDATED DEFAULT LOGO
                const siteName = data.siteName || "TopUp Store";

                // Update Login Logo
                const authLogo = document.getElementById('auth-logo-img');
                if(authLogo) authLogo.src = logoUrl;

                // Update Header Logo
                const headerLogo = document.getElementById('header-logo-img');
                if(headerLogo) headerLogo.src = logoUrl;

                // Update Footer Site Name
                const footerName = document.getElementById('footer-site-name');
                if(footerName) footerName.innerText = siteName;

                // Update Browser Title
                document.title = siteName;
            }
        });
    }
    loadGlobalSettings();

    // --- 2. AUTH LOGIC ---
    function toggleAuth(view) {
        if(view === 'login') {
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('register-form').classList.add('hidden');
            document.getElementById('btn-login-view').classList.add('bg-white', 'shadow', 'text-pink-600');
            document.getElementById('btn-reg-view').classList.remove('bg-white', 'shadow', 'text-pink-600');
        } else {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('register-form').classList.remove('hidden');
            document.getElementById('btn-reg-view').classList.add('bg-white', 'shadow', 'text-pink-600');
            document.getElementById('btn-login-view').classList.remove('bg-white', 'shadow', 'text-pink-600');
        }
    }

    function handleRegister() {
        const name = document.getElementById('reg-name').value;
        const email = document.getElementById('reg-email').value;
        const pass = document.getElementById('reg-pass').value;
        const phone = document.getElementById('reg-phone').value; // Added Phone save

        if(!name || !email || !pass) return Swal.fire('Error', 'Please fill all fields', 'error');

        Swal.showLoading();
        auth.createUserWithEmailAndPassword(email, pass)
            .then((cred) => db.collection('users').doc(cred.user.uid).set({
                name: name, email: email, phone: phone, balance: 0, createdAt: new Date()
            }))
            .then(() => Swal.fire('Success', 'Account Created!', 'success'))
            .catch((err) => Swal.fire('Error', err.message, 'error'));
    }

    function handleLogin() {
        const email = document.getElementById('login-email').value;
        const pass = document.getElementById('login-pass').value;
        if(!email || !pass) return;
        Swal.showLoading();
        auth.signInWithEmailAndPassword(email, pass).catch((err) => Swal.fire('Login Failed', err.message, 'error'));
    }

    function handleLogout() { auth.signOut().then(() => location.reload()); }

    auth.onAuthStateChanged((user) => {
        if (user) {
            currentUser = user;
            document.getElementById('auth-sec').classList.add('hidden');
            document.getElementById('app-content').classList.remove('hidden');
            loadUserData(user.uid);
            calculateUserStats(user.uid);
            loadAppContent();
        } else {
            document.getElementById('auth-sec').classList.remove('hidden');
            document.getElementById('app-content').classList.add('hidden');
        }
    });

    function loadUserData(uid) {
        db.collection('users').doc(uid).onSnapshot((doc) => {
            if (doc.exists) {
                const data = doc.data();
                userBalance = data.balance || data.walletBalance || 0; // Support both field names
                document.getElementById('header-balance').innerText = userBalance;
                document.getElementById('profile-name').innerText = data.name || "User";
                document.getElementById('profile-email').innerText = data.email;
                document.getElementById('profile-balance').innerText = userBalance;
            }
        });
    }

    function calculateUserStats(uid) {
        document.getElementById('profile-total-orders').innerText = "...";
        document.getElementById('profile-total-spent').innerText = "...";

        db.collection('orders').where('userId', '==', uid).get().then((snapshot) => {
            let totalOrders = 0;
            let totalSpent = 0;

            snapshot.forEach((doc) => {
                const data = doc.data();
                totalOrders++;
                const status = data.status ? data.status.toLowerCase() : '';
                if (status === 'success' || status === 'complete' || status === 'completed') {
                    totalSpent += parseInt(data.price || 0);
                }
            });

            document.getElementById('profile-total-orders').innerText = totalOrders;
            document.getElementById('profile-total-spent').innerText = totalSpent;
        }).catch(err => {
            document.getElementById('profile-total-orders').innerText = "0";
            document.getElementById('profile-total-spent').innerText = "0";
        });
    }

    // --- 3. APP CONTENT & FEATURES ---

    function loadAppContent() {
        // FIXED: Reading from 'settings/global' instead of 'general'
        db.collection("settings").doc("global").onSnapshot((doc) => {
            if(doc.exists) {
                const data = doc.data();

                // Notice
                if(data.notice) document.getElementById('notice-text').innerText = data.notice;

                // FIXED: Reading nested objects for WhatsApp/Telegram matching Admin structure
                const waNum = (data.customerServiceLinks && data.customerServiceLinks.whatsapp) ? data.customerServiceLinks.whatsapp : "01700000000";
                const tgLink = (data.customerServiceLinks && data.customerServiceLinks.telegram) ? data.customerServiceLinks.telegram : "#";
                const appLink = data.appLink || "#";

                // Home Buttons Update
                document.getElementById('home-whatsapp').href = "https://wa.me/" + waNum;
                document.getElementById('home-telegram').href = tgLink;
                
                const homeAppBtn = document.getElementById('home-app-dl');
                homeAppBtn.href = appLink;
                homeAppBtn.onclick = function(e) {
                    if(appLink === "#" || !appLink) {
                        e.preventDefault();
                        Swal.fire('Notice', 'App coming soon!', 'info');
                    }
                };

                // Footer Links
                const ftAppBtn = document.getElementById('ft-app-link');
                ftAppBtn.href = appLink;
                if(appLink !== "#") {
                    ftAppBtn.onclick = function(e) {
                        e.preventDefault();
                        window.open(appLink, '_blank');
                    };
                }

                document.getElementById('ft-whatsapp').href = "https://wa.me/" + waNum;
                document.getElementById('ft-wa-num').innerText = waNum;
                document.getElementById('ft-telegram').href = tgLink;
                
                // Social Media
                if(data.facebook) document.getElementById('ft-fb').href = data.facebook;
                if(data.instagram) document.getElementById('ft-insta').href = data.instagram;
                if(data.youtube) document.getElementById('ft-yt').href = data.youtube;
                
                // Floating Support Modal Links
                document.getElementById('link-telegram').href = tgLink;
                document.getElementById('link-whatsapp').href = "https://wa.me/" + waNum;
            }
        });

        // Load Games
        db.collection("services").onSnapshot((snapshot) => {
            const list = document.getElementById('services-list');
            list.innerHTML = "";
            gamesData = {}; 
            
            if(snapshot.empty) return list.innerHTML = `<div class="col-span-3 text-center text-gray-400">No Games Found</div>`;
            
            snapshot.forEach(doc => {
                const item = doc.data();
                gamesData[doc.id] = item; 

                list.innerHTML += `
                     <div onclick="openTopUpPage('${doc.id}', '${item.name}', '${item.image}')" 
                          class="bg-white rounded-lg shadow-sm overflow-hidden cursor-pointer transform hover:-translate-y-1 transition-all duration-300 border border-gray-100 group">
                        <div class="w-full aspect-square bg-gray-50 overflow-hidden relative">
                            <img src="${item.image}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" 
                            onerror="this.src='https://placehold.co/200'">
                        </div>
                        <div class="p-2 text-center bg-white border-t border-gray-50">
                            <p class="text-[10px] font-bold text-gray-700 truncate">${item.name}</p>
                        </div>
                    </div>
                `;
            });
        });

        // Load Tutorials
        db.collection("tutorials").onSnapshot((snapshot) => {
            const container = document.getElementById('tutorial-list-container');
            container.innerHTML = "";
            snapshot.forEach(doc => {
                const data = doc.data();
                container.innerHTML += `
                    <div class="mx-5 bg-white rounded-2xl shadow-lg overflow-hidden border border-gray-100 mb-6">
                        <div class="relative w-full h-48 bg-gray-200 group cursor-pointer" onclick="window.open('${data.link}', '_blank')">
                            <img src="${data.thumbnail}" class="w-full h-full object-cover">
                            <div class="absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center"><i class="fas fa-play text-white text-4xl"></i></div>
                        </div>
                        <div class="p-4 text-center"><h3 class="font-bold text-gray-800">${data.title}</h3></div>
                    </div>`;
            });
        });

        loadBanners();
        loadHistory();
        loadRecentOrdersGlobal(); 
    }

    // --- 4. TOPUP SYSTEM ---

    function openTopUpPage(gameId, gameName, gameImg) {
        selectedGameId = gameId;
        selectedGameName = gameName;
        selectedProduct = null;
        document.getElementById('total-price').innerText = "0";
        document.getElementById('game-player-id').value = "";

        document.getElementById('topup-game-title').innerText = gameName;
        document.getElementById('topup-sub-title').innerText = gameName + " ";
        document.getElementById('topup-game-img').src = gameImg;

        const rulesBox = document.getElementById('game-rules-box');
        const rulesText = document.getElementById('game-rules-text');
        
        if(gamesData[gameId] && gamesData[gameId].rules) {
            rulesText.innerText = gamesData[gameId].rules;
            rulesBox.classList.remove('hidden');
        } else {
            rulesBox.classList.add('hidden');
        }

        showSec('topup');
        
        const grid = document.getElementById('products-grid');
        const loader = document.getElementById('product-loader');
        grid.innerHTML = "";
        loader.classList.remove('hidden');

        db.collection('services').doc(gameId).collection('products').orderBy('price', 'asc').get()
            .then((snapshot) => {
                loader.classList.add('hidden');
                if(snapshot.empty) {
                    grid.innerHTML = `<div class="col-span-2 text-center text-gray-400 py-4">No packages available</div>`;
                    return;
                }
                snapshot.forEach(doc => {
                    const prod = doc.data();
                    const card = document.createElement('div');
                    card.className = "product-card";
                    card.onclick = () => selectProduct(card, prod.name, prod.price, doc.id);
                    card.innerHTML = `
                        <div class="flex items-center">
                            <div class="product-bullet"></div>
                            <span class="text-xs font-bold text-gray-600">${prod.name}</span>
                        </div>
                        <span class="text-pink-600 font-bold text-sm">৳${prod.price}</span>
                    `;
                    grid.appendChild(card);
                });
            });
    }

    function selectProduct(element, name, price, id) {
        document.querySelectorAll('.product-card').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');
        selectedProduct = { id: id, name: name, price: parseInt(price) };
        document.getElementById('total-price').innerText = selectedProduct.price;
    }

    function processOrder() {
        const playerId = document.getElementById('game-player-id').value.trim();
        
        if(!playerId) return Swal.fire({ icon: 'warning', title: 'Missing ID', text: 'Please enter Player ID!' });
        if(!selectedProduct) return Swal.fire({ icon: 'warning', title: 'Select Pack', text: 'Please select a recharge package!' });
        if(userBalance < selectedProduct.price) return Swal.fire({ icon: 'error', title: 'Low Balance', text: 'Please Add Money first.' });

        Swal.fire({
            title: 'Confirm Purchase?',
            html: `UID: <b>${playerId}</b><br>Package: ${selectedProduct.name}<br>Price: ৳${selectedProduct.price}`,
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: '#ec4899',
            confirmButtonText: 'Yes, Buy Now'
        }).then((result) => {
            if (result.isConfirmed) {
                Swal.showLoading();
                const newBalance = userBalance - selectedProduct.price;

                db.collection('users').doc(currentUser.uid).update({ balance: newBalance })
                .then(() => {
                    return db.collection('orders').add({
                        userId: currentUser.uid,
                        userName: currentUser.email,
                        gameName: selectedGameName,
                        gameId: selectedGameId,
                        playerId: playerId,
                        productName: selectedProduct.name,
                        price: selectedProduct.price,
                        status: 'pending',
                        date: new Date()
                    });
                })
                .then(() => {
                    Swal.fire('Success', 'Order Placed Successfully!', 'success');
                    showSec('home');
                })
                .catch(err => Swal.fire('Error', err.message, 'error'));
            }
        });
    }

    // --- OTHER HELPERS ---

    function showSec(secId) {
        document.querySelectorAll('main section').forEach(s => s.classList.add('hidden'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active-tab'));
        document.getElementById(secId + '-sec').classList.remove('hidden');
        const navBtn = document.getElementById('nav-' + secId);
        if(navBtn) navBtn.classList.add('active-tab');
        
        if(secId === 'addmoney') resetAddMoney();
        if(secId === 'history') loadHistory();
    }

    // --- HISTORY FUNCTION ---
    function loadHistory() {
        const list = document.getElementById('history-list');
        if(!currentUser) return;
        
        list.innerHTML = '<div class="text-center py-4"><i class="fas fa-spinner fa-spin text-pink-500"></i> Loading History...</div>';

        db.collection('orders')
          .where('userId', '==', currentUser.uid)
          .limit(20)
          .get()
          .then(snapshot => {
            list.innerHTML = "";
            
            if(snapshot.empty) { 
                list.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-10 text-gray-400">
                        <i class="fas fa-shopping-basket text-4xl mb-3 opacity-30"></i>
                        <p>No orders found yet.</p>
                    </div>`; 
                return; 
            }

            let orders = [];
            snapshot.forEach(doc => orders.push(doc.data()));
            orders.sort((a, b) => {
                let dateA = a.date && a.date.toDate ? a.date.toDate() : new Date(a.date);
                let dateB = b.date && b.date.toDate ? b.date.toDate() : new Date(b.date);
                return dateB - dateA; 
            });

            orders.forEach(d => {
                let statusColor = "bg-yellow-100 text-yellow-700 border-yellow-500";
                let icon = "fa-clock";
                
                if (d.status === 'success' || d.status === 'complete') {
                    statusColor = "bg-green-100 text-green-700 border-green-500";
                    icon = "fa-check-circle";
                } else if (d.status === 'cancel' || d.status === 'rejected' || d.status === 'refunded') {
                    statusColor = "bg-red-100 text-red-700 border-red-500";
                    icon = "fa-times-circle";
                }

                let dateStr = "N/A";
                if (d.date) {
                    const dateObj = d.date.toDate ? d.date.toDate() : new Date(d.date);
                    const options = { month: 'short', day: 'numeric', hour: 'numeric', minute: 'numeric', hour12: true };
                    dateStr = dateObj.toLocaleString('en-US', options);
                }

                list.innerHTML += `
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 mb-4 overflow-hidden relative">
                        <div class="absolute left-0 top-0 bottom-0 w-1.5 ${statusColor.split(' ')[2]}"></div>
                        <div class="p-3 pl-4">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h4 class="font-bold text-gray-800 text-sm flex items-center gap-1">
                                        <i class="fas fa-gamepad text-pink-500 text-xs"></i> ${d.gameName}
                                    </h4>
                                    <p class="text-[10px] text-gray-400 mt-0.5"><i class="far fa-calendar-alt"></i> ${dateStr}</p>
                                </div>
                                <span class="${statusColor.split(' border')[0]} text-[10px] font-bold px-2 py-1 rounded-full uppercase tracking-wide flex items-center gap-1">
                                    <i class="fas ${icon}"></i> ${d.status}
                                </span>
                            </div>
                            <div class="h-px bg-gray-100 w-full my-2"></div>
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-xs font-bold text-gray-700">${d.productName}</p>
                                    <div class="mt-1 inline-block bg-gray-50 border border-gray-200 rounded px-2 py-0.5">
                                        <p class="text-[10px] text-gray-500 font-mono">UID: <span class="text-gray-700 font-bold select-all">${d.playerId}</span></p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-[10px] text-gray-400 mb-0.5">Price</p>
                                    <p class="text-lg font-bold text-pink-600">৳${d.price}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
        })
        .catch(error => {
            console.error(error);
            list.innerHTML = `<div class="text-center text-red-500 py-4 text-xs font-mono">Error: ${error.message}</div>`;
        });
    }

    function loadRecentOrdersGlobal() {
        const container = document.getElementById('latest-orders-list');
        
        db.collection('orders')
          .orderBy('date', 'desc')
          .limit(5)
          .onSnapshot((snapshot) => {
              if (snapshot.empty) {
                  container.innerHTML = '<div class="text-center text-gray-400 text-xs py-2">No recent orders</div>';
                  return;
              }

              container.innerHTML = "";

              snapshot.forEach(doc => {
                  const data = doc.data();
                  
                  let displayName = "Customer";
                  if(data.userName) {
                      displayName = data.userName.includes('@') ? data.userName.split('@')[0] : data.userName;
                  }
                  const firstChar = displayName.charAt(0).toUpperCase();

                  let statusBadge = '';
                  let statusText = data.status || 'pending';
                  
                  if (statusText === 'success' || statusText === 'complete' || statusText === 'completed') {
                      statusBadge = 'bg-[#198754] text-white'; 
                      statusText = 'completed';
                  } else if (statusText === 'pending' || statusText === 'processing') {
                      statusBadge = 'bg-[#ffc107] text-gray-800';
                      statusText = 'processing';
                  } else {
                      statusBadge = 'bg-red-500 text-white';
                  }

                  const itemHTML = `
                    <div class="bg-white p-3 rounded-xl shadow-[0_2px_10px_rgba(0,0,0,0.03)] border border-gray-100 flex items-center justify-between">
                        <div class="flex items-center gap-3 overflow-hidden">
                            <div class="w-11 h-11 min-w-[44px] bg-[#0d6efd] rounded-full flex items-center justify-center text-white text-lg font-sans font-medium shadow-sm">
                                ${firstChar}
                            </div>
                            <div class="flex flex-col truncate">
                                <span class="text-gray-600 font-bold text-sm truncate">${displayName}</span>
                                <span class="text-gray-500 text-[11px] font-medium truncate">
                                    ${data.productName} - ${data.price} ৳
                                </span>
                            </div>
                        </div>
                        <div class="${statusBadge} px-3 py-1 rounded-full text-[10px] font-bold capitalize shadow-sm whitespace-nowrap ml-2">
                            ${statusText}
                        </div>
                    </div>
                  `;
                  container.innerHTML += itemHTML;
              });
          });
    }

    function toggleSupportModal() { document.getElementById('support-modal').classList.toggle('hidden'); }
    
    function loadBanners() {
        db.collection("banners").onSnapshot((snapshot) => {
            const wrapper = document.getElementById('slider-wrapper');
            let slidesHTML = "";
            snapshot.forEach((doc) => {
                if(doc.data().image) slidesHTML += `<img src="${doc.data().image}" class="w-full h-full object-cover flex-shrink-0">`;
            });
            if(slidesHTML) { wrapper.innerHTML = slidesHTML; startSlider(); }
        });
    }
    
    function startSlider() {
        let idx = 0;
        const wrapper = document.getElementById('slider-wrapper');
        const count = wrapper.children.length;
        if(count > 0) {
            setInterval(() => {
                idx = (idx + 1) % count;
                wrapper.style.transform = `translateX(-${idx * 100}%)`;
            }, 3000);
        }
    }

    // --- ADD MONEY LOGIC (FIXED) ---
    function showPaymentForm(methodName, logoUrl, color) {
        document.getElementById('payment-methods-grid').classList.add('hidden');
        document.getElementById('payment-form-container').classList.remove('hidden');
        document.getElementById('form-logo').src = logoUrl;
        document.getElementById('form-method-name').innerText = methodName;
        
        // FIXED: Reading from 'settings/global' inside 'payment_numbers' map
        db.collection("settings").doc("global").get().then(doc => {
            if(doc.exists && doc.data().payment_numbers) {
                // Access using lowercase key (bkash, nagad, rocket)
                const num = doc.data().payment_numbers[methodName.toLowerCase()];
                document.getElementById('admin-number').innerText = num || "Not Set";
            } else {
                document.getElementById('admin-number').innerText = "Not Available";
            }
        });
    }

    function resetAddMoney() {
        document.getElementById('payment-methods-grid').classList.remove('hidden');
        document.getElementById('payment-form-container').classList.add('hidden');
    }
    function submitDeposit() {
        const amt = document.getElementById('dep-amount').value;
        const trx = document.getElementById('dep-trx').value;
        if(!amt || !trx) return Swal.fire('Error', 'Fill all fields', 'warning');
        
        db.collection('deposits').add({
            userId: currentUser.uid, amount: parseInt(amt), trxId: trx, 
            status: 'pending', date: new Date(), userEmail: currentUser.email,
            method: document.getElementById('form-method-name').innerText
        }).then(() => {
            Swal.fire('Submitted', 'Wait for approval', 'success');
            resetAddMoney();
        });
    }
    function copyNumber() {
        navigator.clipboard.writeText(document.getElementById('admin-number').innerText);
        Swal.fire({toast:true, title:'Copied', icon:'success', position:'top-end', showConfirmButton:false, timer:1000});
    }
</script>
</body>
</html>